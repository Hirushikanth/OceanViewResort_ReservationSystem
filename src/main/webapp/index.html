<!DOCTYPE html>
<html>
<head>
    <title>Login - Ocean View Resort</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="card" style="max-width: 400px; margin: 100px auto;">
    <h2>System Login</h2>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button onclick="login()">Login</button>
    <p id="status"></p>
    <p style="text-align: center; margin-top: 15px;">
        New Customer? <a href="register.html">Register Here</a>
    </p>
</div>

<script src="js/auth.js"></script>
<script>
    // Auto-redirect if already logged in
    if (localStorage.getItem("token")) {
        redirectBasedOnRole(localStorage.getItem("role"));
    }

    async function login() {
        const data = {
            username: document.getElementById("username").value,
            passwordHash: document.getElementById("password").value
        };

        try {
            const response = await fetch(API_BASE + 'login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const result = await response.json();
                localStorage.setItem("token", result.token);
                localStorage.setItem("role", result.role);
                localStorage.setItem("userId", result.id);
                redirectBasedOnRole(result.role);
            } else {
                document.getElementById("status").style.color = "red";
                document.getElementById("status").innerText = "Invalid Credentials";
            }
        } catch (error) {
            document.getElementById("status").innerText = "Server Error";
        }
    }
</script>
</body>
</html>